<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ywq1113.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="My Personal Blog">
<meta property="og:url" content="http://ywq1113.github.io/index.html">
<meta property="og:site_name" content="My Personal Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="yangwq">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://ywq1113.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-cn'
  };
</script>

  <title>My Personal Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">My Personal Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://ywq1113.github.io/2020/07/02/Cpp%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yangwq">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Personal Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/02/Cpp%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/" class="post-title-link" itemprop="url">C++内存模型</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-07-02 16:22:56 / Modified: 16:24:25" itemprop="dateCreated datePublished" datetime="2020-07-02T16:22:56+08:00">2020-07-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="C-的内存模型"><a href="#C-的内存模型" class="headerlink" title="C++的内存模型"></a>C++的内存模型</h1><p><a href="https://preshing.com/20120930/weak-vs-strong-memory-models/" target="_blank" rel="noopener">弱vs强内存模型</a></p>
<p><a href="https://preshing.com/20120625/memory-ordering-at-compile-time/" target="_blank" rel="noopener">编译时内存排序</a></p>
<p><a href="https://preshing.com/20120710/memory-barriers-are-like-source-control-operations/" target="_blank" rel="noopener">运行时内存排序</a></p>
<p><a href="http://senlinzhan.github.io/2017/12/04/cpp-memory-order/" target="_blank" rel="noopener">理解C++的Memory Order</a></p>
<p>这些文章对于内存模型的讲解非常好，建议阅读，本文整理一下相关的知识点。</p>
<h2 id="Memory-Barrier的类型"><a href="#Memory-Barrier的类型" class="headerlink" title="Memory Barrier的类型"></a>Memory Barrier的类型</h2><ul>
<li><p>LoadLoad</p>
<p>有效的保护了在屏障之前执行的读取和屏障之后执行的读取。</p>
<p>举个例子，<code>git pull</code>命令，如果在执行中有其他的merge conflicts(合并分支的冲突)，这时无法保证会提取数据库的最新版本。使用<code>LOADLOAD_FENCE()</code>可以保证不会看到过时的数据，</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(IsPublished)</span><br><span class="line">&#123;</span><br><span class="line">  LOADLOAD_FENCE();</span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>StoreStore</p>
<p>有效的保护了在屏障之前的存储和屏障之后的存储</p>
<p>同样地，考虑<code>git push</code>的过程，同时该过程是延迟、异步的行为。所以无法保证在执行push之后，无法保证它之前存储的数据在整个数据库中是可见的。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">value = x;</span><br><span class="line">STORESOTRE_FENCE();</span><br><span class="line">IsPublished = <span class="number">1</span>;  <span class="comment">//标记一下存储完成</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>LoadStore</p>
<p>从内存中拷贝到cpu，再从cpu拷贝到内存，这种指令会重排。</p>
<p>在实际的cpu中，如果load时高速缓存未命中，然后在存储上命中高速缓存，某些处理器就会发生重排，让其先存储再读取。</p>
</li>
<li><p>StoreLoad</p>
<p>确保屏障执行之前的存储对所有处理器都是可见的，并且屏障执行之后的读取都是接收的可见的最新值，实现了顺序一致性（唯一一种可以防止race condition的内存屏障）。</p>
</li>
</ul>
<h2 id="硬件层面内存模型"><a href="#硬件层面内存模型" class="headerlink" title="硬件层面内存模型"></a>硬件层面内存模型</h2><p>不同的处理器在内存重新排序的过程中具有不同的习惯，只能在多核/多处理器中观察到。如上方博客中所介绍，x86/64架构的计算机普遍是strong memory model。</p>
<p>那么硬件层面的强/弱内存模型区别是什么呢？<code>A strong hardware memory model is one in which every machine instruction comes implicitly with acquire and release semantics. As a result, when one CPU core performs a sequence of writes, every other CPU core sees those values change in the same order that they were written.</code>文章中是这么描述的，意思是每条机器指令都隐式地带有获取/释放语义。因此，当一个核执行一系列写操作时，每一个cpu的核都能看到写入的值和写入的顺序。也就是说不会存在 loadload、loadstore、storestore 的重排，可以进行的是 storeload 的重排。</p>
<p>Note: acquire语义是指load之后的读写操作无法被重排到load之前；release语义是指store之前的操作无法被重排到store之后。</p>
<p><a href="https://preshing.com/20120515/memory-reordering-caught-in-the-act/" target="_blank" rel="noopener">https://preshing.com/20120515/memory-reordering-caught-in-the-act/</a></p>
<p>上方链接是一个示例程序显示重排发生的原因。主要思路是在信号量<code>sem_wait()</code>之后对共享内存进行写入操作，在<code>sem_post()</code>之前对共享内存进行读取操作，这样确保acquire/release的语义，这是一种不会发生重排的做法。如果用两个信号量给两个线程发送(sem_post)，操作一番，等待两个线程(sem_wait)，再用一个for循环统计迭代多少次以后会发生重排（如果数值不符合预期就是发生了重排）。会发现60万次迭代中有90多次发生了重排。</p>
<p>如果想消除这些重新排序，有这么几种做法：</p>
<p>（1）提高线程关联性，让两个工作线程都在同一个cpu上运行，但是可移植性差；</p>
<p>（2）引入cpu屏障，<code>StoreLoad Barrier</code>，在gcc中可以用`asm volatile(“mfence” ::: “memory”)，防止内存重新排序</p>
<h2 id="软件层面内存模型"><a href="#软件层面内存模型" class="headerlink" title="软件层面内存模型"></a>软件层面内存模型</h2><p>如果在语言层面实现对多线程共享变量的控制，忽略编译器和cpu架构的不同对多线程编程的影响，这样就可以跨平台了。</p>
<p>在C++11之后提供了六种不同的memory_order选项</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="built_in">std</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">enum</span> memory_order</span><br><span class="line">    &#123;</span><br><span class="line">        memory_order_relaxed, memory_order_consume, memory_order_acquire,</span><br><span class="line">        memory_order_release, memory_order_acq_rel, memory_order_seq_cst</span><br><span class="line">    &#125; memory_order;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>memory_order_seq_cst</p>
<p>顺序一致性，默认的选项，不允许reorder</p>
</li>
<li><p>memory_order_release/acquire/acq_rel</p>
<p>release和acquire的重排都可能造成存取过程的不同步，acq_rel是保证了线程不同时进入临界区。</p>
</li>
<li><p>memory_order_relaxed</p>
<p>宽松操作，没有同步或顺序的制约，仅仅对<code>load()</code>和<code>store()</code>操作保证原子性。</p>
</li>
</ul>
<p>编写测试用例时，用到全局变量，让两个线程对其读/写就可以看到race condition(x86架构下只要是原子变量不会出现竞态，硬件保证了获取/释放语义)。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://ywq1113.github.io/2020/06/19/CSAPP%E4%BC%98%E5%8C%96%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yangwq">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Personal Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/19/CSAPP%E4%BC%98%E5%8C%96%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD/" class="post-title-link" itemprop="url">CSAPP优化程序性能</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-06-19 16:49:06 / Modified: 16:57:47" itemprop="dateCreated datePublished" datetime="2020-06-19T16:49:06+08:00">2020-06-19</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="优化程序性能"><a href="#优化程序性能" class="headerlink" title="优化程序性能"></a>优化程序性能</h1><p>来源于CSAPP第五章</p>
<h2 id="消除不必要的内存引用"><a href="#消除不必要的内存引用" class="headerlink" title="消除不必要的内存引用"></a>消除不必要的内存引用</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//可以设计不同的数据类型来测量程序性能</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">data_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">long</span> len;</span><br><span class="line">    <span class="keyword">data_t</span> *data;</span><br><span class="line">&#125; vec_rec, *vec_ptr;</span><br><span class="line"></span><br><span class="line"><span class="comment">//设计对数据执行不同的运算</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IDENT 0  <span class="comment">//求和，如果是求乘积设为1</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OP +  <span class="comment">//如果求乘积设为*</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">combin3</span><span class="params">(vec_ptr v, <span class="keyword">data_t</span>* dest)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> i;</span><br><span class="line">    <span class="keyword">long</span> length = vec_length(v);  <span class="comment">//减少循环中的函数调用</span></span><br><span class="line">    <span class="keyword">data_t</span>* data = get_vec_start(v);  <span class="comment">//减少过程调用的优化</span></span><br><span class="line"></span><br><span class="line">    *dest = IDENT;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        *dest = *dest OP data[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述代码的汇编码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># vmovsd代表从指定的位置读数据</span><br><span class="line">.L17:                    # loop:</span><br><span class="line">vmovsd  (%rbx), %xmm0    # Read product from dest          指针dest的地址从%xmm0读出来，存在寄存器%rbx中</span><br><span class="line">vmulsd  (%rdx), %xmm0    # Multiply product by data[i]     第i个元素的指针保存在%rdx中</span><br><span class="line">vmovsd  %xmm0, (%rbx)    # Store product at dest           将rbx中的数据读出，存入%xmm0中</span><br><span class="line">addq    $8, %rdx         # Increment data + i</span><br><span class="line">cmpq    %rax, %rdx       # Compare to data+length          data+length存放在%rax中</span><br><span class="line">jne     .L17             # If !&#x3D;, goto loop</span><br></pre></td></tr></table></figure>

<p>进入循环后，从内存中读数据，和<code>data[i]</code>乘，再写入到内存中。这种操作比较浪费，因为循环下次读的数据是上次写入内存的数据。</p>
<p>可以用一个临时变量来存储结果，等循环结束后再写入内存中。这样每次循环可以减少一次写的过程。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">combin4</span><span class="params">(vec_ptr v, <span class="keyword">data_t</span>* dest)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> i;</span><br><span class="line">    <span class="keyword">long</span> length = vec_length(v);  </span><br><span class="line">    <span class="keyword">data_t</span>* data = get_vec_start(v);  </span><br><span class="line">    <span class="keyword">data_t</span> acc = IDENT;  <span class="comment">//temp variable</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        acc = acc OP data[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    *data = acc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>值得注意的是，从代码层面看指令是一条一条执行的，但是实际处理器中是同时对多条指令求值，这种现象称为指令级并行。所以这两种操作限制了程序的瓶颈：第一个是指令必须按照严格顺序执行，那就会遇到延迟界限；第二个是吞吐量界限（取决于处理器原始计算能力）。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://ywq1113.github.io/2020/06/09/Linux%E9%AB%98%E5%B9%B6%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E8%BF%BD%E8%B8%AA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yangwq">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Personal Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/09/Linux%E9%AB%98%E5%B9%B6%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E8%BF%BD%E8%B8%AA/" class="post-title-link" itemprop="url">Linux高并发服务器内存泄漏追踪转载</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-09 22:43:24" itemprop="dateCreated datePublished" datetime="2020-06-09T22:43:24+08:00">2020-06-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-19 22:20:36" itemprop="dateModified" datetime="2020-06-19T22:20:36+08:00">2020-06-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>看了一篇博客，个人感觉很有帮助，目前转载过来留存，正在征询作者意见，如果不同意就删掉啦。</p>
<p>原文链接：<a href="https://blog.csdn.net/kenanxiuji/article/details/48547285" target="_blank" rel="noopener">https://blog.csdn.net/kenanxiuji/article/details/48547285</a></p>
<p>最近，我一直忙于追踪分析，咱公司高并发代理服务器内存一直占用过高的问题。该问题表现如下，使用python脚本压测，服务器使用的物理内存一直飙升很快上G、虚拟内存更是高达数10G，没有下降的趋势。当压测程序停止运行后，整个服务占用的物理内存以及虚拟内存并没有下降的趋势。</p>
<p>首先简诉咱服务器运行的平台是centos-6.3（linux-2.6.32），该服务器是多进程的，基于libevent网络通信框架，以bufferevent为核心，并使用google::protobuf通信协议进行数据传输。</p>
<p>根据top -p /pmap -dx 等命令，检测出咱服务器进程内存占用很高，我揣测产生了内存泄露。内存泄露有两种，第一种是进程一直持有不在需要或者使用的内存，这不是狭义的内存泄露，因为没有野指针的产生，可以归为广义的内存泄露，这是危害最大的，也是很难捕捉的内存泄露，使用valgrind等工具是没有办法检测出来的；第二种是进程通过malloc、new分配了堆内存，却由于各种原因，未能释放，这是狭义的内存泄露，可以通过valgrind等内存泄露工具检测到的。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/06/09/Linux%E9%AB%98%E5%B9%B6%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E8%BF%BD%E8%B8%AA/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://ywq1113.github.io/2020/06/09/CentOS7%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5mysqlclient/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yangwq">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Personal Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/09/CentOS7%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5mysqlclient/" class="post-title-link" itemprop="url">CentOS7无法连接mysqlclient</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-06-09 18:46:33 / Modified: 18:52:35" itemprop="dateCreated datePublished" datetime="2020-06-09T18:46:33+08:00">2020-06-09</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在makefile中用了<code>-lmysqlclient</code>,但是会报错<code>/usr/bin/ld: cannot find -lmysqlclient</code>。</p>
<p>先在/user/lib中查，发现没有，用find / -name mysqlclient发现也没有。</p>
<p>于是借助搜索引擎去查，结果国内论坛怎么也没找到解决办法，不得已去看官方C API，发现让重新下载解压，遂放弃。</p>
<p>随后又在stack overflow搜索了一下，果不其然，成功解决。附上解决方案：<a href="https://stackoverflow.com/questions/15958612/libmysqlclient-a-is-nowhere-to-be-found" target="_blank" rel="noopener">https://stackoverflow.com/questions/15958612/libmysqlclient-a-is-nowhere-to-be-found</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://ywq1113.github.io/2020/06/08/%E7%BC%93%E5%AD%98%E8%AF%BB%E5%86%99%E4%B8%80%E8%87%B4%E6%80%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yangwq">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Personal Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/08/%E7%BC%93%E5%AD%98%E8%AF%BB%E5%86%99%E4%B8%80%E8%87%B4%E6%80%A7/" class="post-title-link" itemprop="url">缓存读写一致性</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-08 17:54:22" itemprop="dateCreated datePublished" datetime="2020-06-08T17:54:22+08:00">2020-06-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-19 22:22:36" itemprop="dateModified" datetime="2020-06-19T22:22:36+08:00">2020-06-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="缓存读写一致性问题"><a href="#缓存读写一致性问题" class="headerlink" title="缓存读写一致性问题"></a>缓存读写一致性问题</h1><p>在知乎看（搜索）到这么一个问题：如何用redis/memcache做Mysql缓存层？刚好最近学的项目只是用到了mysql，这里学习整理一下缓存的知识。PS：强烈建议学习陈皓大神的文章以及阅读英文原文，中文博客知识需要进行筛选。</p>
<p>知乎问题<a href="https://www.zhihu.com/question/27738066" target="_blank" rel="noopener">https://www.zhihu.com/question/27738066</a></p>
<p>陈皓(左耳朵耗子)的文章<a href="https://coolshell.cn/articles/17416.html" target="_blank" rel="noopener">https://coolshell.cn/articles/17416.html</a></p>
<p>首先要讨论的是，缓存删除还是更新的问题。<strong>什么情况下选择删除，什么情况下选择更新</strong>？</p>
<ul>
<li><p>缓存存储的value是序列化的对象</p>
<p>  序列化和反序列化需要消耗cpu的资源，删除缓存成本更低，等出现下次数据汇源时再更新。</p>
</li>
<li><p>高并发的场景</p>
<p>  两个并发操作，一个查询缓存，一个更新操作。先更新（选择删除缓存），再查询，此时无法命中缓存，会先把老的数据从数据库读出放入缓存中，然后更新数据库。此时缓存中是脏的数据，并且一直这样脏下去。所以，这种场景应该选择缓存更新，而不是删除Cache后再从数据库更新。</p>
</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/06/08/%E7%BC%93%E5%AD%98%E8%AF%BB%E5%86%99%E4%B8%80%E8%87%B4%E6%80%A7/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://ywq1113.github.io/2020/06/08/unordered-map%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%AE%E7%B1%BB%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yangwq">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Personal Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/08/unordered-map%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%AE%E7%B1%BB%E5%9E%8B/" class="post-title-link" itemprop="url">unordered_map使用自定义键类型</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-08 16:26:51" itemprop="dateCreated datePublished" datetime="2020-06-08T16:26:51+08:00">2020-06-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-19 22:23:11" itemprop="dateModified" datetime="2020-06-19T22:23:11+08:00">2020-06-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="unordered-map定义-C-11"><a href="#unordered-map定义-C-11" class="headerlink" title="unordered_map定义(C++11)"></a>unordered_map定义(C++11)</h1><p><a href="https://blog.csdn.net/y109y/article/details/82669620#3.1" target="_blank" rel="noopener">参考博客</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Key</span>,</span></span><br><span class="line"><span class="class">    <span class="title">class</span> <span class="title">T</span>,</span></span><br><span class="line"><span class="class">    <span class="title">class</span> <span class="title">Hash</span> = <span class="title">std</span>:</span>:hash&lt;Key&gt;,</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">KeyEqual</span> = <span class="title">std</span>:</span>:equal_to&lt;Key&gt;,</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Allocator</span> = <span class="title">std</span>:</span>:allocator&lt; <span class="built_in">std</span>::pair&lt;<span class="keyword">const</span> Key, T&gt; &gt;</span><br><span class="line">&gt; <span class="class"><span class="keyword">class</span> <span class="title">unordered_map</span>;</span></span><br></pre></td></tr></table></figure>

<p>Key代表键值（key），T是根据哈希函数得到的值（value），Hash是哈希函数的函数对象，KeyEqual是等比函数的函数对象，通过<code>&quot;==&quot;</code>来判断两个key是否相等。<br>想实现自定义的键类型，必须实现hash函数和等比函数。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/06/08/unordered-map%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%AE%E7%B1%BB%E5%9E%8B/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://ywq1113.github.io/2020/05/24/malloc%E5%92%8Calloc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yangwq">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Personal Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/24/malloc%E5%92%8Calloc/" class="post-title-link" itemprop="url">malloc和alloc</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-05-24 21:33:33 / Modified: 21:53:53" itemprop="dateCreated datePublished" datetime="2020-05-24T21:33:33+08:00">2020-05-24</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="malloc和alloc"><a href="#malloc和alloc" class="headerlink" title="malloc和alloc"></a>malloc和alloc</h1><p>在网上找到的转载的英文资料，附上自己的一些理解<a href="https://blog.csdn.net/missuever/article/details/540045" target="_blank" rel="noopener">点击连接</a></p>
<p>Both the <code>malloc()</code> and the <code>calloc()</code> functions are used to allocate dynamic memory. Each operates slightly different from the other.</p>
<p>malloc和calloc函数都用来分配动态内存，他们之间的差别很小</p>
<p><code>malloc()</code> takes a size and returns a pointer to a chunk of memory at least that big: </p>
<p><code>void *malloc( size_t size );</code></p>
<p>malloc返回至少有申请内存大小的一块内存（可能更大）</p>
<p><code>calloc()</code> takes a number of elements, and the size of each, and returns a pointer to a chunk of memoryat least big enough to hold them all:</p>
<p><code>void *calloc( size_t numElements, size_t sizeOfElement );</code></p>
<p>calloc返回至少有多块内存大小之和的内存（可能更大）</p>
<p>There are one major difference and one minor difference between the two functions. The major difference is that <code>malloc()</code> does not initialize the allocated memory. The first time <code>malloc()</code> gives you a particular chunk of memory, the memory might be full of zeros. If memory has been allocated, freed, and reallocated, it probably has whatever junk was left in it. That means, unfortunately, that a program might run in simple cases (when memory is never reallocated) but break when used harder (and when memory is reused).</p>
<p>他们之间最主要的差别是，malloc不初始化分配的内存，可能内存中充满的是零。如果内存已经被分配、释放或重新分配过，它可能存放着未知的内容。这意味着当这块内存从申请，修改，再到被重新分配，包含未知的内容会导致程序崩溃</p>
<p><code>calloc()</code> fills the allocated memory with all zero bits. That means that anything there you are going to use as a char or an int of any length, signed or unsigned, is guaranteed to be zero. Anything you are going to use as a pointer is set to all zero bits. That is usually a null pointer, but it is not guaranteed.Anything you are going to use as a float or double is set to all zero bits; that is a floating-point zero on some types of machines, but not on all.</p>
<p>calloc()用0 bits填充分配的内存，所以不需要初始化。通常这是一个空指针，但并不保证一定是。使用float或double类型被置为zero bits，在某些机器上是浮点零，但不保证一定是。</p>
<p>The minor difference between the two is that <code>calloc()</code> returns an array of objects; <code>malloc()</code> returns one object. Some people use <code>calloc()</code> to make clear that they want an array.</p>
<p>一些细小差别是calloc()返回一个包含对象的数组，而malloc返回一个对象。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://ywq1113.github.io/2020/05/09/muduo%E5%BA%93%E6%BA%90%E7%A0%81Buffer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yangwq">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Personal Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/09/muduo%E5%BA%93%E6%BA%90%E7%A0%81Buffer/" class="post-title-link" itemprop="url">muduo库源码Buffer</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-09 15:12:25" itemprop="dateCreated datePublished" datetime="2020-05-09T15:12:25+08:00">2020-05-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-19 22:23:51" itemprop="dateModified" datetime="2020-06-19T22:23:51+08:00">2020-06-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Buffer的功能需求"><a href="#Buffer的功能需求" class="headerlink" title="Buffer的功能需求"></a>Buffer的功能需求</h1><p>设计buffer可以从易用性和性能两方面考虑，muduo的buffer更偏向于易用性。</p>
<ul>
<li>对外表现是一块连续的内存<code>(char* p, int len)</code></li>
<li>其<code>size()</code>可以自动增长，不是固定大小的数组</li>
<li>内部以<code>std::vector&lt;int&gt;</code>来保存数据</li>
<li>buffer更像一个queue，从尾部写入数据，从头部读取数据</li>
<li><code>input buffer</code>：连接从socket中读取数据，写入<code>input buffer</code>；客户代码从中读取数据</li>
<li><code>output buffer</code>：客户代码把数据写入<code>output buffer</code>，连接从<code>output buffer</code>中读数据并写入socket</li>
</ul>
<h1 id="muduo-base基础库"><a href="#muduo-base基础库" class="headerlink" title="muduo/base基础库"></a>muduo/base基础库</h1><p>在学习muduo如何实现Buffer之前，先阅读<code>Buffer.h</code>头文件中所需要的依赖。</p>
<h2 id="types-h"><a href="#types-h" class="headerlink" title="types.h"></a>types.h</h2><p>基本类型的声明，如<code>muduo::string</code>；<br>具体有：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">memZero</span><span class="params">(<span class="keyword">void</span>* p, <span class="keyword">size_t</span> n)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//作为static_cast&lt;&gt;或const_cast&lt;&gt;的安全版本</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> To, <span class="keyword">typename</span> From&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> To <span class="title">implicit_cast</span><span class="params">(From <span class="keyword">const</span> &amp;f)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//当upcast使用implicit_cast&lt;&gt;，downcast时static_cast&lt;&gt;不再安全，这里使用</span></span></span><br><span class="line"><span class="function"><span class="comment">//dynamic_cast&lt;&gt;来检查downcast是否合法</span></span></span><br><span class="line"><span class="function"><span class="comment">//不支持RTTI，如</span></span></span><br><span class="line"><span class="function"><span class="comment">//if(dynamic_cast&lt;subclass&gt;(foo)) HandleSubclassObj(foo);</span></span></span><br><span class="line">template&lt;typename To, typename From&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> To <span class="title">down_cast</span><span class="params">(From* f)</span></span></span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/05/09/muduo%E5%BA%93%E6%BA%90%E7%A0%81Buffer/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://ywq1113.github.io/2020/05/08/%E7%BA%A6%E7%91%9F%E5%A4%AB%E7%8E%AF%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yangwq">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Personal Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/08/%E7%BA%A6%E7%91%9F%E5%A4%AB%E7%8E%AF%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">约瑟夫环问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-08 22:23:25" itemprop="dateCreated datePublished" datetime="2020-05-08T22:23:25+08:00">2020-05-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-19 22:24:23" itemprop="dateModified" datetime="2020-06-19T22:24:23+08:00">2020-06-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>约瑟夫环来源于犹太历史学家Josephus所讲述的一个故事。罗马人占领某地后，39个犹太人和Josephus以及他的朋友躲到了一个洞中。<br>他们决定围成一个圈，逐个自杀也不要被罗马人抓住。自杀规则是从第一个人开始，数到3的人就自杀，然后由下一个人重新报数。<br>Josephus和他的朋友不想自杀，他们自己选择了两个位置，活到了最后。</p>
<p>将这个问题抽象以后，在LeetCode上有这么一道题<a href="https://leetcode-cn.com/problems/yuan-quan-zhong-zui-hou-sheng-xia-de-shu-zi-lcof/" target="_blank" rel="noopener">圆圈中最后剩下的数字</a><br>在我做笔试的经历中，出现了题目的变种，变化之处在于删除的数字间隔是变化的，随着删除个数而增长。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/05/08/%E7%BA%A6%E7%91%9F%E5%A4%AB%E7%8E%AF%E9%97%AE%E9%A2%98/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://ywq1113.github.io/2020/05/08/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yangwq">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Personal Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/08/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">单例模式学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-08 09:47:36" itemprop="dateCreated datePublished" datetime="2020-05-08T09:47:36+08:00">2020-05-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-25 17:27:39" itemprop="dateModified" datetime="2020-06-25T17:27:39+08:00">2020-06-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h1><p>单例模式的精髓是一个类只产生一个实例对象，当对象被构造以后，阻止构造、拷贝构造、赋值和析构操作。</p>
<p>单例模式可以考虑以下问题，如线程安全性和如何优化等。本文讨论学习单例模式过程中通过博客和书籍学习到的解决方案。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/05/08/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E5%AD%A6%E4%B9%A0/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="yangwq"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">yangwq</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">豫ICP备20013789号 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yangwq</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
