<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ywq1113.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="My Personal Blog">
<meta property="og:url" content="http://ywq1113.github.io/index.html">
<meta property="og:site_name" content="My Personal Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="yangwq">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://ywq1113.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-cn'
  };
</script>

  <title>My Personal Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">My Personal Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://ywq1113.github.io/2020/05/09/muduo%E5%BA%93%E6%BA%90%E7%A0%81Buffer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yangwq">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Personal Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/09/muduo%E5%BA%93%E6%BA%90%E7%A0%81Buffer/" class="post-title-link" itemprop="url">muduo库源码Buffer</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-09 15:12:25" itemprop="dateCreated datePublished" datetime="2020-05-09T15:12:25+08:00">2020-05-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-14 12:50:30" itemprop="dateModified" datetime="2020-05-14T12:50:30+08:00">2020-05-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Buffer的功能需求"><a href="#Buffer的功能需求" class="headerlink" title="Buffer的功能需求"></a>Buffer的功能需求</h1><p>设计buffer可以从易用性和性能两方面考虑，muduo的buffer更偏向于易用性。</p>
<ul>
<li>对外表现是一块连续的内存<code>(char* p, int len)</code></li>
<li>其<code>size()</code>可以自动增长，不是固定大小的数组</li>
<li>内部以<code>std::vector&lt;int&gt;</code>来保存数据</li>
<li>buffer更像一个queue，从尾部写入数据，从头部读取数据</li>
<li><code>input buffer</code>：连接从socket中读取数据，写入<code>input buffer</code>；客户代码从中读取数据</li>
<li><code>output buffer</code>：客户代码把数据写入<code>output buffer</code>，连接从<code>output buffer</code>中读数据并写入socket</li>
</ul>
<h1 id="muduo-base基础库"><a href="#muduo-base基础库" class="headerlink" title="muduo/base基础库"></a>muduo/base基础库</h1><p>在学习muduo如何实现Buffer之前，先阅读<code>Buffer.h</code>头文件中所需要的依赖。</p>
<h2 id="types-h"><a href="#types-h" class="headerlink" title="types.h"></a>types.h</h2><p>基本类型的声明，如<code>muduo::string</code>；<br>具体有：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">memZero</span><span class="params">(<span class="keyword">void</span>* p, <span class="keyword">size_t</span> n)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//作为static_cast&lt;&gt;或const_cast&lt;&gt;的安全版本</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> To, <span class="keyword">typename</span> From&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> To <span class="title">implicit_cast</span><span class="params">(From <span class="keyword">const</span> &amp;f)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//当upcast使用implicit_cast&lt;&gt;，downcast时static_cast&lt;&gt;不再安全，这里使用</span></span></span><br><span class="line"><span class="function"><span class="comment">//dynamic_cast&lt;&gt;来检查downcast是否合法</span></span></span><br><span class="line"><span class="function"><span class="comment">//不支持RTTI，如</span></span></span><br><span class="line"><span class="function"><span class="comment">//if(dynamic_cast&lt;subclass&gt;(foo)) HandleSubclassObj(foo);</span></span></span><br><span class="line">template&lt;typename To, typename From&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> To <span class="title">down_cast</span><span class="params">(From* f)</span></span></span><br></pre></td></tr></table></figure>
<h2 id="StringPiece-h"><a href="#StringPiece-h" class="headerlink" title="StringPiece.h"></a>StringPiece.h</h2><p> 传递C风格的字符串参数给函数，知乎有个相关的提问与回答<a href="https://www.zhihu.com/question/34499426" target="_blank" rel="noopener">点击查看</a>，<code>StringPiece</code>是某公司使用的一个类。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringArg</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">  StringArg(<span class="keyword">const</span> <span class="keyword">char</span>* str) </span><br><span class="line">  	: str_(str)</span><br><span class="line">  &#123; &#125;</span><br><span class="line">  </span><br><span class="line">  StringArg(<span class="keyword">const</span> <span class="built_in">string</span>&amp; str) </span><br><span class="line">  	: str_(str.c_str())</span><br><span class="line">  &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">const</span> <span class="keyword">char</span>* <span class="title">c_str</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> str_; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span>* str_;</span><br></pre></td></tr></table></figure>
<p>提供non-explicit构造函数给使用者，可以传递<code>const char*</code>或<code>string</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MUDUO_BASE_STRINGPIECE_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MUDUO_BASE_STRINGPIECE_H</span></span><br><span class="line"><span class="keyword">namespace</span> muduo &#123;</span><br><span class="line">&#123;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringPiece</span> &#123;</span></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span>*   ptr_;</span><br><span class="line">  <span class="keyword">int</span>           length_;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">//default</span></span><br><span class="line">  StringPiece()</span><br><span class="line">  	: ptr_(<span class="literal">NULL</span>), length_(<span class="number">0</span>) &#123; &#125;</span><br><span class="line">  <span class="comment">//参数为字符指针</span></span><br><span class="line">  StringPiece(<span class="keyword">const</span> <span class="keyword">char</span>* str)</span><br><span class="line">    : ptr_(str), length_(<span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(<span class="built_in">strlen</span>(ptr_))) &#123; &#125;</span><br><span class="line">  <span class="comment">//参数为无符号字符指针; reinterpret_cast临时隐藏类型，使用时要将其转换为原型</span></span><br><span class="line">  <span class="comment">//具有非常强的转换能力</span></span><br><span class="line">  StringPiece(<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span>* str)</span><br><span class="line">    : ptr_(<span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">const</span> <span class="keyword">char</span>*&gt;(str)),</span><br><span class="line">      length_(<span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(<span class="built_in">strlen</span>(ptr_))) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  StringPiece(<span class="keyword">const</span> <span class="built_in">string</span>&amp; str)</span><br><span class="line">    : ptr_(str.data()), length_(<span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(str.size())) &#123; &#125;</span><br><span class="line">    </span><br><span class="line">  StringPiece(<span class="keyword">const</span> <span class="keyword">char</span>* offset, <span class="keyword">int</span> len)</span><br><span class="line">    : ptr_(offset), length_(len) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//string类常见成员</span></span><br><span class="line">  <span class="function"><span class="keyword">const</span> <span class="keyword">char</span>* <span class="title">data</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> ptr_; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> length_; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">empty</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> length_ == <span class="number">0</span>; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">const</span> <span class="keyword">char</span>* <span class="title">begin</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> ptr_; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">const</span> <span class="keyword">char</span>* <span class="title">end</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> ptr_ + length_; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123; ptr_ = <span class="literal">NULL</span>; length_ = <span class="number">0</span>; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* buffer, <span class="keyword">int</span> len)</span> </span>&#123; ptr_ = buffer; length = len; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* str)</span> </span>&#123; </span><br><span class="line">  	ptr = str;</span><br><span class="line">  	length_ = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(<span class="built_in">strlen</span>(str)); </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//运算符成员函数[], ==,</span></span><br><span class="line">  <span class="keyword">char</span> <span class="keyword">operator</span>[](<span class="keyword">int</span> i) <span class="keyword">const</span> &#123; <span class="keyword">return</span> _ptr[i]; &#125;</span><br><span class="line">  <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> StringPiece&amp; x) <span class="keyword">const</span> &#123;</span><br><span class="line">  	<span class="keyword">return</span> (x.length_ == length_) &amp;&amp;</span><br><span class="line">  		   (<span class="built_in">memcmp</span>(x.ptr_, ptr_, length_) == <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">bool</span> <span class="keyword">operator</span>!=(<span class="keyword">const</span> StringPiece&amp; x) <span class="keyword">const</span> &#123;</span><br><span class="line">  	<span class="keyword">return</span> !(*<span class="keyword">this</span> == x);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//比较成员函数</span></span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">compare</span><span class="params">(<span class="keyword">const</span> StringPiece&amp; x)</span> <span class="keyword">const</span> </span>&#123; ... &#125;</span><br><span class="line">  <span class="comment">//转换成string类型</span></span><br><span class="line">  <span class="function"><span class="built_in">string</span> <span class="title">as_string</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">CopyToString</span><span class="params">(<span class="built_in">string</span>* target)</span> </span>&#123; ... &#125;</span><br><span class="line">  <span class="comment">//判断起始字符</span></span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">start_with</span><span class="params">(<span class="keyword">const</span> StringPiece&amp; x)</span> <span class="keyword">const</span> </span>&#123; ... &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#125; <span class="comment">// namespace muduo</span></span><br><span class="line">  <span class="comment">//允许String Pieces被记录到日志中</span></span><br><span class="line">  <span class="built_in">std</span>::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(<span class="built_in">std</span>::ostream o&amp;, <span class="keyword">const</span> muduo::StringPieces piece);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<h1 id="muduo-net网络库"><a href="#muduo-net网络库" class="headerlink" title="muduo/net网络库"></a>muduo/net网络库</h1><h2 id="Buffer-cc和Buffer-h"><a href="#Buffer-cc和Buffer-h" class="headerlink" title="Buffer.cc和Buffer.h"></a>Buffer.cc和Buffer.h</h2><p><img src="https://img-blog.csdnimg.cn/20200501173424887.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpYW9waWppYW5nMjMz,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>1）<strong>特点</strong>：封装vector作为缓冲区，因为vector为一块连续空间，且其本身具有自动增长的性质，迭代器为原始指针，使用起来较为方便<br>2）<strong>分布</strong>：缓冲区分为三个部分<br>prependable：大小为<code>readerIndex</code><br>readable：大小为<code>writerIndex - readerIndex</code><br>writeable：大小为<code>size() - writerIndex</code><br>初始时，readable == 0，readIndex = writeIndex = 8；<br>3）<strong>检索</strong>：Buffer类通过<code>findCRLF</code>和<code>findEOL</code>成员函数在<code>readerable</code>区域检索<code>\r\n</code>和<code>EOL</code><br>4）<strong>调整区域</strong>：</p>
<ul>
<li>通过成员函数<code>hasWritten</code>和<code>unwrite</code>调整可读/可写区域的大小，如果向Buffer写入200字节，那么<code>writeIndex += 200</code>，<code>readable == 200</code>，<code>writable == 824</code>；</li>
<li>成员函数<code>read()</code>和<code>retrieve()</code>读入50字节，<code>readIndex += 50</code>，<code>readable == 150</code>，<code>writable == 824</code>；当一次性读完时，调用<code>retrieveall()</code>将<code>Buffer</code>重置</li>
</ul>
<p>5）<strong>自动增长</strong>：如果客户代码一次性写入1000字节，而当前可写字节小于这个数（prependable+writable），那么buffer就会自动增长以容纳全部数据。<br>6）<strong>内部挪腾</strong>：当可写字节满足需求，但是writable大小不足时，移动readable，腾出位置<br>7）<strong>前方添加</strong>：提供prependable，让程序能以很小的代价在数据前面添加几个字节。比如说要序列化一个消息，但是并不知道消息长度，于是不断append()直到序列化完成，此时可以通过readable区域变化求出消息长度，在prependable中用4个字节存储。<br>8）<strong>读取内容</strong>：利用<code>readfd()</code>，在栈上开辟一块65536字节额外缓冲区，利用readv()来读。注意在muduo中只调用了一次readv来读取数据是因为它采用的是level trigger，而不是edge trigger。如果采用边缘触发，就需要使用一个while循环来不断读取，直到把缓冲区的内容读取完。边缘触发相比水平触发会进行更多次的系统调用，对追求低延迟的程序而言不一定更高效。边缘触发更适合高并发，比如系统中存在很多不需要读写的就绪文件描述符，水平触发每次都会返回不断通知，边缘触发只通知一次，直到有第二次的读写事件发生。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Buffer</span> :</span> <span class="keyword">public</span> muduo::copyable </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="comment">//1) 用一个vector来维护一个缓冲区</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt; buffer_;</span><br><span class="line">  <span class="keyword">size_t</span> readerIndex_;</span><br><span class="line">  <span class="keyword">size_t</span> writerIndex_;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> kCRLF[];</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="function"><span class="keyword">char</span>* <span class="title">begin</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> &amp;*buffer_.begin(); &#125;  <span class="comment">//使用vector自身的迭代器,begin()返回缓冲区起始元素</span></span><br><span class="line">  <span class="function"><span class="keyword">char</span>* <span class="title">beginWrite</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> begin() + writeIndex_; &#125;  <span class="comment">//获得writeable区的起始元素</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">size_t</span> kCheapPrepend = <span class="number">8</span>;  <span class="comment">//定义prepenable初始大小为8</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">size_t</span> kInitialSize = <span class="number">1024</span>;  <span class="comment">//定义writeable初始大小为1024</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//2) 求缓冲区三个部分的大小</span></span><br><span class="line">  <span class="function"><span class="keyword">size_t</span> <span class="title">readableBytes</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">  </span>&#123; <span class="keyword">return</span> writerIndex_ - readerIndex_; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">size_t</span> <span class="title">writableBytes</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">  </span>&#123; <span class="keyword">return</span> buffer_.size() - writerIndex_; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">size_t</span> <span class="title">prependableBytes</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">  </span>&#123; <span class="keyword">return</span> readerIndex_; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">const</span> <span class="keyword">char</span>* <span class="title">peek</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> begin() + readerIndex_; &#125;  <span class="comment">//求readerable的头部指针</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//3) 检索"/r/n"和EOL</span></span><br><span class="line">  <span class="function"><span class="keyword">const</span> <span class="keyword">char</span>* <span class="title">findCRLF</span><span class="params">()</span> <span class="keyword">const</span> </span></span><br><span class="line"><span class="function">  </span>&#123; </span><br><span class="line">  	<span class="keyword">const</span> <span class="keyword">char</span>* crlf = <span class="built_in">std</span>::search(peek(), beginWrite(), kCRLF, kCRLF+<span class="number">2</span>)  <span class="comment">//检索范围是readable区域，搜索的元素范围是[kCRLF,kCRLF+2]</span></span><br><span class="line">  	<span class="keyword">return</span> crlf == beginWrite() ? <span class="literal">NULL</span> : crlf;  <span class="comment">//若search返回尾部迭代器则没有找到</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//重载findCRLF，可以自定义检索起始位置</span></span><br><span class="line">  <span class="function"><span class="keyword">const</span> <span class="keyword">char</span>* <span class="title">findCRLF</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* start)</span> <span class="keyword">const</span> </span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">  	assert(peek() &lt;= start);</span><br><span class="line">  	assert(start &lt;= beginWrite());</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">const</span> <span class="keyword">char</span>* <span class="title">findEOL</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; ... &#125;  <span class="comment">//在readerable中搜索换行符</span></span><br><span class="line">  <span class="function"><span class="keyword">const</span> <span class="keyword">char</span>* <span class="title">findEOL</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* start)</span> <span class="keyword">const</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="comment">//4) 写入和未写入移动writerIndex来调整可读/可写区域的大小</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">hasWritten</span><span class="params">(<span class="keyword">size_t</span> len)</span> </span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">	assert(len &lt;= writableBytes());</span><br><span class="line">	writerIndex += len;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">unwrite</span><span class="params">(<span class="keyword">size_t</span> len)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    assert(len &lt;= readableBytes());</span><br><span class="line">    writerIndex_ -= len;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//从缓冲区中读取数据</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">retrieve</span><span class="params">(<span class="keyword">size_t</span> len)</span> </span>&#123; ... &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">retrieveAll</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    readerIndex_ = kCheapPrepend;</span><br><span class="line">    writerIndex_ = kCheapPrepend;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">append</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* data, <span class="keyword">size_t</span> len)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    ensureWritableBytes(len);</span><br><span class="line">    <span class="built_in">std</span>::copy(data, data+len, beginWrite());</span><br><span class="line">    hasWritten(len);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//5) 自动增长</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">ensureWritableBytes</span><span class="params">(<span class="keyword">size_t</span> len)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (writableBytes() &lt; len)</span><br><span class="line">    &#123;</span><br><span class="line">      makeSpace(len);</span><br><span class="line">    &#125;</span><br><span class="line">    assert(writableBytes() &gt;= len);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//6) 内部腾挪</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">makeSpace</span><span class="params">(<span class="keyword">size_t</span> len)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (writableBytes() + prependableBytes() &lt; len + kCheapPrepend)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// <span class="doctag">FIXME:</span> move readable data</span></span><br><span class="line">      buffer_.resize(writerIndex_+len);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// move readable data to the front, make space inside buffer</span></span><br><span class="line">      assert(kCheapPrepend &lt; readerIndex_);</span><br><span class="line">      <span class="keyword">size_t</span> readable = readableBytes();</span><br><span class="line">      <span class="comment">//std::copy(first, last, destfirst) 要拷贝元素的首地址、尾地址和拷贝目的地首地址</span></span><br><span class="line">      <span class="built_in">std</span>::copy(begin()+readerIndex_,</span><br><span class="line">                begin()+writerIndex_,</span><br><span class="line">                begin()+kCheapPrepend);</span><br><span class="line">      readerIndex_ = kCheapPrepend;</span><br><span class="line">      writerIndex_ = readerIndex_ + readable;</span><br><span class="line">      assert(readable == readableBytes());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//8) 读取内容</span></span><br><span class="line"><span class="function"><span class="keyword">ssize_t</span> <span class="title">Buffer::readFd</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">int</span>* savedErrno)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> extrabuf[<span class="number">65536</span>];  <span class="comment">//在栈上开辟一块额外的缓冲区</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">iovec</span> <span class="title">vec</span>[2];</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">size_t</span> writable = writableBytes();</span><br><span class="line">  <span class="comment">//iovec第一块指向buffer中的writable，第二块指向extrabuf</span></span><br><span class="line">  vec[<span class="number">0</span>].iov_base = begin()+writerIndex_;</span><br><span class="line">  vec[<span class="number">0</span>].iov_len = writable;</span><br><span class="line">  vec[<span class="number">1</span>].iov_base = extrabuf;</span><br><span class="line">  vec[<span class="number">1</span>].iov_len = <span class="keyword">sizeof</span> extrabuf;</span><br><span class="line">  <span class="comment">//当空间足够时，即 n &lt; writable，不使用extrabuf</span></span><br><span class="line">  <span class="comment">//否则读到extrabuf，然后再把extrabuf中的数据append()到Buffer中</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">int</span> iovcnt = (writable &lt; <span class="keyword">sizeof</span> extrabuf) ? <span class="number">2</span> : <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">ssize_t</span> n = sockets::readv(fd, vec, iovcnt);  <span class="comment">//readv返回读到的总字节数n</span></span><br><span class="line">  <span class="keyword">if</span> (n &lt; <span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    *savedErrno = errno;  <span class="comment">//存储异常</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (implicit_cast&lt;<span class="keyword">size_t</span>&gt;(n) &lt;= writable)</span><br><span class="line">  &#123;</span><br><span class="line">    writerIndex_ += n;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    writerIndex_ = buffer_.size();</span><br><span class="line">    append(extrabuf, n - writable);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://ywq1113.github.io/2020/05/08/%E7%BA%A6%E7%91%9F%E5%A4%AB%E7%8E%AF%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yangwq">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Personal Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/08/%E7%BA%A6%E7%91%9F%E5%A4%AB%E7%8E%AF%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">约瑟夫环问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-08 22:23:25" itemprop="dateCreated datePublished" datetime="2020-05-08T22:23:25+08:00">2020-05-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-11 15:05:50" itemprop="dateModified" datetime="2020-05-11T15:05:50+08:00">2020-05-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>约瑟夫环来源于犹太历史学家Josephus所讲述的一个故事。罗马人占领某地后，39个犹太人和Josephus以及他的朋友躲到了一个洞中。<br>他们决定围成一个圈，逐个自杀也不要被罗马人抓住。自杀规则是从第一个人开始，数到3的人就自杀，然后由下一个人重新报数。<br>Josephus和他的朋友不想自杀，他们自己选择了两个位置，活到了最后。</p>
<p>将这个问题抽象以后，在LeetCode上有这么一道题<a href="https://leetcode-cn.com/problems/yuan-quan-zhong-zui-hou-sheng-xia-de-shu-zi-lcof/" target="_blank" rel="noopener">圆圈中最后剩下的数字</a><br>在我做笔试的经历中，出现了题目的变种，变化之处在于删除的数字间隔是变化的，随着删除个数而增长。</p>
<h1 id="求解思路"><a href="#求解思路" class="headerlink" title="求解思路"></a>求解思路</h1><h2 id="循环数组（链表）"><a href="#循环数组（链表）" class="headerlink" title="循环数组（链表）"></a>循环数组（链表）</h2><p>题中是一个圈，所以启发我们用一个循环数组或链表来解决这个问题。由于数组需要一整块的内存且删除操作不如链表，本文选则STL库容器list来实现<br>一个环形链表。只需要迭代器每次扫描到链表末尾时，将其移动到链表头部即可。</p>
<p>需要注意的点：</p>
<p>1) 扫描链表时，一定要注意走到<code>list.end()</code>要转移到<code>begin()</code><br>2) <code>list.erase()</code>删除操作，迭代器移动到被删除节点的下一个位置，所以重点关注next节点<br>是否是尾部迭代器。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">LastRemainNum</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> n, <span class="keyword">unsigned</span> <span class="keyword">int</span> m)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n &lt; <span class="number">1</span> || m &lt; <span class="number">1</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    usigned <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt; r_list;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        r_list.push_back(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt;::iterator it = <span class="built_in">list</span>.begin();</span><br><span class="line">    <span class="keyword">while</span>(r_list.size() &gt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; m; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            it++;</span><br><span class="line">            <span class="keyword">if</span>(it == r_list.end())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//m = m+1; 如果m是变化的，可以在这里修改m的数值</span></span><br><span class="line">                it = r_list.begin();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">auto</span> next = ++it;</span><br><span class="line">        <span class="keyword">if</span>(next == r_list.end())</span><br><span class="line">        &#123;</span><br><span class="line">            next = r_list.begin();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        it--;</span><br><span class="line">        r_list.erase(it);</span><br><span class="line">        it = next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> *it;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="数学思路"><a href="#数学思路" class="headerlink" title="数学思路"></a>数学思路</h2><p>我们可以这样考虑</p>
<p>1）剩两个元素时，数数从0开始，是0-&gt;1-&gt;0，0这个位置会被删除，1保留下来；</p>
<p>2）剩下三个元素时，0-&gt;1-&gt;2，0-&gt;1-&gt;0，2和0被删掉，1保留下来；</p>
<p>3) 剩下四个元素，0-&gt;1-&gt;2，3-&gt;0-&gt;1，3-&gt;0-&gt;3，删掉顺序是2，1，3，0保留下来；</p>
<p>4) 剩下五个元素，…，删除顺序是2，0，4，1，3保留下来</p>
<p>乍一看是看不出来规律，但是我们动手算的过程中会发现：</p>
<ul>
<li>假设剩余n个元素(2 &lt;= n)，m个间隔，最终保留的下标是res1 = f(n,m)。</li>
<li>假设对于n+1个数，位置为res2 = f(n+1,m)的数保留；</li>
<li>那么在删除一个元素的过程中，res2的位置和res1有什么关系？</li>
<li></li>
</ul>
<p>此时思路已经相对明显了，我们来尝试进行倒推。<br>f(2,3) = 1;<br>f(3,3) = (f(2,3) + m) % 3; //<br>f(4,3) = (f(3,3) + m) % 4;<br>…<br>f(n,m) = (f(n-1,m) + m) % n</p>
<table>
<thead>
<tr>
<th>人数</th>
<th>位置</th>
<th>间隔</th>
</tr>
</thead>
<tbody><tr>
<td>2</td>
<td>1</td>
<td>3</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>3</td>
</tr>
<tr>
<td>4</td>
<td>0</td>
<td>3</td>
</tr>
<tr>
<td>5</td>
<td>3</td>
<td>3</td>
</tr>
</tbody></table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://ywq1113.github.io/2020/05/08/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yangwq">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Personal Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/08/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">单例模式学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-08 09:47:36" itemprop="dateCreated datePublished" datetime="2020-05-08T09:47:36+08:00">2020-05-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-11 15:04:36" itemprop="dateModified" datetime="2020-05-11T15:04:36+08:00">2020-05-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h1><p>单例模式的精髓是一个类只产生一个实例对象，当对象被构造以后，阻止构造、拷贝构造、赋值和析构操作。<br>单例模式可以考虑以下问题，如线程安全性和如何优化等。本文讨论学习单例模式过程中通过博客和书籍<br>学习到的解决方案。</p>
<h2 id="单线程-饿汉式"><a href="#单线程-饿汉式" class="headerlink" title="单线程(饿汉式)"></a>单线程(饿汉式)</h2><p>保证类仅有一个实例，并提供一个访问它的全局访问点。</p>
<ul>
<li>构造函数私有化，避免外界使用new来创造实例 (思考=delete和设为private的区别在哪里？)</li>
<li>通过判断一个局部static变量来确定是否创造实例</li>
<li>通过接口<code>GetInstance</code>来取得实例</li>
</ul>
<p>由于这种设计方案使用了静态成员，类产生时就创建好了实例对象，也被称作<strong>饿汉模式</strong>，是一种<br>空间换时间的做法。同时饿汉式也是<strong>线程安全</strong>的。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">static</span> Singleton* p_instance; <span class="comment">//单例的对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Singleton() = <span class="keyword">default</span>;</span><br><span class="line">    Singleton(<span class="keyword">const</span> Singleton&amp;);</span><br><span class="line">    Singleton&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> Singleton&amp;);</span><br><span class="line">    ~Singleton() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//Singleton() = delete;</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> Singleton* <span class="title">GetInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(p_instance == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            p_instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> p_instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteInstance</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">delete</span> p_instantce;</span><br><span class="line">        p_instance = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化静态成员变量</span></span><br><span class="line">Singleton* Singleton::p_instance = <span class="literal">nullptr</span>;</span><br></pre></td></tr></table></figure>
<p>从代码中可以看出来是线程安全的，而在多线程中，如果采用懒汉模式，需要使用该实例时才创建，可能存在A线程进入if语句后B线程已经实例化一个对象，这样就会产生两个实例，不符合单例模式的需求。</p>
<h2 id="多线程-懒汉模式"><a href="#多线程-懒汉模式" class="headerlink" title="多线程(懒汉模式)"></a>多线程(懒汉模式)</h2><ul>
<li>通过对临界区加锁，避免多个线程同时访问Singleton</li>
<li>避免锁的开销，只有未被实例化时才加锁(双重检查锁)</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">static</span> Singleton* p_instance; <span class="comment">//单例的对象</span></span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">std</span>::mutex m_mutex;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> Singleton* <span class="title">GetInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(p_instance == <span class="literal">nullptr</span>) </span><br><span class="line">        &#123;</span><br><span class="line">            lock(m_mutex)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(p_instance == <span class="literal">nullptr</span>)</span><br><span class="line">                    p_instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteInstance</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">delete</span> p_instantce;</span><br><span class="line">        p_instance = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Singleton* Singleton::p_instance = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="built_in">std</span>::mutex Singleton::m_mutex;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://ywq1113.github.io/2020/04/28/TCP%E4%B8%89%E8%B7%AF%E6%8F%A1%E6%89%8B%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yangwq">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Personal Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/28/TCP%E4%B8%89%E8%B7%AF%E6%8F%A1%E6%89%8B%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/" class="post-title-link" itemprop="url">TCP三路握手四次挥手</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-28 15:56:10 / Modified: 16:25:13" itemprop="dateCreated datePublished" datetime="2020-04-28T15:56:10+08:00">2020-04-28</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>面试时无数次被问到这个知识点，但是回答的时候总是不够特别详尽以及需要面试官再次追问。所以最好一次性就能把所有这块知识点回答完才算是合格的准备。</p>
<h1 id="TCP三次握手"><a href="#TCP三次握手" class="headerlink" title="TCP三次握手"></a>TCP三次握手</h1><h2 id="TCP三次握手过程"><a href="#TCP三次握手过程" class="headerlink" title="TCP三次握手过程"></a>TCP三次握手过程</h2><p>客户端一开始处于closed状态，开启三次握手，发送一个SYN给服务端进入SYN_SENT状态，TCP报文中seq的初始值是随着时间而变化的一个值，防止在网络中延迟的分组在以后又被传送导致某一方对它做出错误的解释；服务端接收到SYN后，进入SYN_RECV的状态，延迟一段时间后发送自己的SYN/seq和对客户端SYN的一个确认ACK/ack，报头中确认号的值是seq+1因为ack本身也占了一位，延迟确认可以降低网络流量，以及减少网络中小的报文段；客户端接收到服务端的ack后，发送对服务端SYN的确认，此后双方进入ESTABLISHED状态。</p>
<p>为什么不能是两次握手？TCP三次握手可以进行优化嘛？TCP可以在握手期间传送数据嘛？这其实都是一个问题，就是探讨两次握手会造成什么危害。<br>个人理解的是，TCP两次握手是客户端接收到服务端的SYN和ack双方就默认建立连接。假设服务端之前返回的SYN&amp;ACK报文在网络中遗失，当再次发送给客户端，客户端误以为要建立连接，就直接维护了这个连接，但服务端端并没有数据的传输，浪费了服务器的性能。</p>
<h2 id="SYN洪水攻击"><a href="#SYN洪水攻击" class="headerlink" title="SYN洪水攻击"></a>SYN洪水攻击</h2><p>针对三次握手，而产生的一种攻击方式。客户端和服务器使用TCP协议发起会话时，会在内存中开辟一小块缓冲区来处理会话过程中的消息交换。<br>1）大量虚假ip发送SYN：服务器返回ack找不到地址，触发重传机制<br>2）拦截客户机应答报文：两次握手后，拦截客户端对服务端的应答，服务端收不到ACK会再次发送第二次握手确认报文。</p>
<h1 id="TCP四次挥手"><a href="#TCP四次挥手" class="headerlink" title="TCP四次挥手"></a>TCP四次挥手</h1><p>客户端和服务端双方初始状态为ESTABLISHED，客户端发送一个FIN/seq，进入FIN_WAIT_1状态；服务端接收到FIN后，返回一个ACK/seq+1，表示知道对方要关闭连接，进入CLOSE_WAIT被动关闭状态。等服务端也没有数据需要发送后，会给对端发送一个FIN/seq，表示自己要关闭连接，进入LAST ACK状态；客户端接收到后，返回一个ACK/seq+1进入TIME_WAIT状态，时间为2MSL，避免服务端没有收到此ACK再次发送报文。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://ywq1113.github.io/2020/04/27/%E7%BC%93%E5%AD%98%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yangwq">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Personal Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/27/%E7%BC%93%E5%AD%98%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">缓存常见问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-27 11:39:39" itemprop="dateCreated datePublished" datetime="2020-04-27T11:39:39+08:00">2020-04-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-16 13:52:04" itemprop="dateModified" datetime="2020-05-16T13:52:04+08:00">2020-05-16</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="什么是缓存"><a href="#什么是缓存" class="headerlink" title="什么是缓存"></a>什么是缓存</h1><p>缓存是数据交换的缓冲区，某一硬件读取数据时总是先从缓存中查询，不存在时去内存找，内存找不到再去外存中查找。</p>
<h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><p>实现高性能和高并发（服务器）</p>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><p>操作系统磁盘缓存——减少磁盘机械操作</p>
<p>数据库缓存——减少文件系统的IO次数</p>
<p>应用程序缓存——减少对数据库的查询</p>
<p>Web服务器缓存——减少应用服务器请求</p>
<p>客户端浏览器请求——减少对网站的访问</p>
<h1 id="缓存常见问题及解决方法"><a href="#缓存常见问题及解决方法" class="headerlink" title="缓存常见问题及解决方法"></a>缓存常见问题及解决方法</h1><h2 id="缓存与数据双写不一致"><a href="#缓存与数据双写不一致" class="headerlink" title="缓存与数据双写不一致"></a>缓存与数据双写不一致</h2><p>只要用到缓存，就存在缓存和数据库双存储双写的一致性问题。</p>
<p>解决方案：</p>
<p>1）读写串行化：读的时候先读缓存，没有就读数据库，然后取出放入缓存中，同时返回响应；写的时候先更新数据库，然后删除缓存。（思考不删除缓存，直接更新缓存行不行？）</p>
<h2 id="redis缓存雪崩"><a href="#redis缓存雪崩" class="headerlink" title="redis缓存雪崩"></a>redis缓存雪崩</h2><p>缓存中大批量热点数据过期后涌入大量查询请求，此时缓存服务器失效，或者是缓存服务器宕机，请求渗透到数据库层，引起数据库压力造成查询堵塞或宕机。</p>
<p>事前：redis高可用，主从+哨兵，redis cluster避免全盘崩溃</p>
<p>事后：redis持久化，一旦重启自动从磁盘上加载数据，快速恢复缓存数据</p>
<p>解决方案：<br>系统A接收到请求后，先查本地cache，没查到再去检查redis，redis中也没有再去查数据库，将数据库的结果写入到cache和redis中。限流组件可以设置每秒的请求有多少通过组件，未通过的请求返回一个默认值或友情提醒。</p>
<h2 id="redis缓存穿透"><a href="#redis缓存穿透" class="headerlink" title="redis缓存穿透"></a>redis缓存穿透</h2><p>对于系统A，假设每秒5000个请求，其中4000个是黑客发出的恶意攻击。而这4000个请求在缓存中找不到，数据库中也找不到，会直接增加数据库的压力。</p>
<p>解决方案：<br>1）使用bloom filter，检查key是否存在，如果不存在直接拒绝掉，可能存在的再发送到后面的redis。缺陷是布隆过滤器后期维护比较麻烦，数据只能新增不能删除并且初始化时需要导入缓存的全盘数据；<br>2）多级缓存，本地缓存再来一层</p>
<h2 id="缓存击穿"><a href="#缓存击穿" class="headerlink" title="缓存击穿"></a>缓存击穿</h2><p>对于一个热点key，在缓存失效的一瞬间有5000个请求同时访问就会击穿缓存直接访问数据库。</p>
<p>解决方案：1）将热点数据设置为永远不过期；2）基于redis实现互斥锁，等第一个请求构建完缓存后再释放锁，进而其他请求才能通过key访问数据。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://ywq1113.github.io/2020/04/26/gdb%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E7%A7%AF%E7%B4%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yangwq">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Personal Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/26/gdb%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E7%A7%AF%E7%B4%AF/" class="post-title-link" itemprop="url">gdb使用方法积累(不断更新)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-26 21:34:53" itemprop="dateCreated datePublished" datetime="2020-04-26T21:34:53+08:00">2020-04-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-11 15:07:32" itemprop="dateModified" datetime="2020-05-11T15:07:32+08:00">2020-05-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="makefile"><a href="#makefile" class="headerlink" title="makefile"></a>makefile</h1><p>1）如果不把生成的最后执行的文件放在第一行，输入make它就默认只执行第一行的code。<br>2）如果是在centOS7下面拷贝的话，会自动转换<code>TAB</code>为空格，然后编译命令失去作用。</p>
<h1 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h1><p>只适用于无状态的服务器，因为不能保证是同一个工作线程处理多个客户请求。同一个连接上的客户请求，可能由不同的线程来处理。</p>
<h2 id="pthread-create-函数"><a href="#pthread-create-函数" class="headerlink" title="pthread_create()函数"></a>pthread_create()函数</h2><p><code>pthread_create</code>函数第三个参数必须指向一个静态函数(static)，否则编译没办法通过。如果想在static函数中使用类的动态成员（如成员函数和成员变量），通过以下方法来实现：<br>1）通过类的静态对象来调用；<br>2）将类的对象作为参数传递给静态函数，然后在静态函数中引用这个对象，并调用其动态方法。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">threadpool</span>&#123;</span></span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span>* <span class="title">worker</span><span class="params">(<span class="keyword">void</span>* arg)</span></span>;</span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">            <span class="keyword">public</span>:</span><br><span class="line">                ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span>* <span class="title">threadpool::worker</span><span class="params">(<span class="keyword">void</span>* arg)</span></span>&#123;</span><br><span class="line">        threadpool* pool = (threadpool*)arg;</span><br><span class="line">            pool-&gt;run();</span><br><span class="line">                <span class="keyword">return</span> pool;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="bind失败"><a href="#bind失败" class="headerlink" title="bind失败"></a>bind失败</h1><p>在华为云服务器上bind失败，原因可能如下：<br><strong>1）端口未开放</strong><br>查看端口开放命令<br><code>lsof -i:80</code><br><code>netstat -aptn |grep -i 80</code> 查看所有端口命令<br><code>netstat -lptn |grep -i 80</code>  查看TCP命令<br><code>netstat -lpun |grep -i 80</code> 查看UDP命令</p>
<p><strong>2）端口已被占用</strong></p>
<h1 id="CentOS7查看核心数"><a href="#CentOS7查看核心数" class="headerlink" title="CentOS7查看核心数"></a>CentOS7查看核心数</h1><p><code>grep &#39;core id&#39; /proc/cpuinfo | sort -u | wc -l</code>  华为云服务器是单核的</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://ywq1113.github.io/2020/04/26/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yangwq">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Personal Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/26/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-26 18:24:09" itemprop="dateCreated datePublished" datetime="2020-04-26T18:24:09+08:00">2020-04-26</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">yangwq</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">7</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">豫ICP备20013789号 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yangwq</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
